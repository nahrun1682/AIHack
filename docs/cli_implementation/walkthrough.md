# ウォークスルー: CLIモード実装とゲームエンジン分離

## 概要
ゲームロジックを Streamlit (`app.py`) から分離し、新しく作成した `GameEngine` クラス (`game_engine.py`) に集約しました。
これにより、コマンドラインインターフェース (CLI) からもゲームがプレイ可能になり、コードの再利用性とテスト容易性が向上しました。

## 変更内容

### 1. ゲームエンジンの作成
- **[NEW] `game_engine.py`**:
    - ゲームの状態管理（プレイヤー情報、会話履歴、ステージ進行）をカプセル化。
    - `process_turn_stream` メソッドにより、CLI と Streamlit 両方で共通のターン処理（ストリーミング含む）を実現。

### 2. CLIモードの実装
- **[MODIFY] `main.py`**:
    - `GameEngine` を使用してターミナル上で動作するゲームループを実装。
    - リッチなテキスト表示（色分け）と対話的なプロンプト入力をサポート。

### 3. Streamlitアプリのリファクタリング
- **[MODIFY] `app.py`**:
    - 独自の状態管理ロジックを削除し、`st.session_state.engine` に保持した `GameEngine` インスタンスを使用するように変更。
    - UI ロジックのみを残し、ゲーム進行ロジックを委譲。

## 検証手順

### CLIモードの実行
ターミナルで以下のコマンドを実行してください：
```bash
python main.py
```
- タイトル画面が表示され、Enterキーなどでステージが開始されるか確認。
- パスワードを引き出す会話ができるか確認。
- クリア後のアップグレード選択が機能するか確認。

### Streamlitモードの実行
従来のコマンドで実行してください：
```bash
uv run streamlit run app.py
```
- 既存のゲームプレイが問題なく行えるか確認（退行テスト）。
- リセットボタンなどが正しく機能するか確認。
